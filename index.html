<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nail Price Calculator - 美甲價目計算機</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body class="bg-[#FDFBF7]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons Components (內嵌 Lucide Icons 以確保單一檔案可執行) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Sparkles = (props) => (
            <IconBase {...props}>
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
            </IconBase>
        );

        const Eraser = (props) => (
            <IconBase {...props}>
                <path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21" />
                <path d="M22 21H7" />
                <path d="m5 11 9 9" />
            </IconBase>
        );

        const Plus = (props) => (
            <IconBase {...props}>
                <path d="M5 12h14" />
                <path d="M12 5v14" />
            </IconBase>
        );

        const Minus = (props) => (
            <IconBase {...props}>
                <path d="M5 12h14" />
            </IconBase>
        );

        const RotateCcw = (props) => (
            <IconBase {...props}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" />
                <path d="M3 3v9h9" />
            </IconBase>
        );

        const HeartHandshake = (props) => (
            <IconBase {...props}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                <path d="M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08v0c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66" />
                <path d="M18 15v2.25" />
                <path d="M17 22h2a2 2 0 0 0 2-2v-5" />
            </IconBase>
        );

        const Check = (props) => (
            <IconBase {...props}>
                <path d="M20 6 9 17l-5-5" />
            </IconBase>
        );

        const Copy = (props) => (
            <IconBase {...props}>
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
            </IconBase>
        );
        
        const ClipboardCheck = (props) => (
            <IconBase {...props}>
                <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                <path d="m9 14 2 2 4-4" />
            </IconBase>
        );

        // --- Main App Component ---
        const App = () => {
            // 狀態管理
            const [selectedService, setSelectedService] = useState(null);
            const [selectedRemoval, setSelectedRemoval] = useState(null);
            const [repairCount, setRepairCount] = useState(0);
            const [isCatEyeUpgrade, setIsCatEyeUpgrade] = useState(false);
            const [total, setTotal] = useState(0);
            const [showCopyToast, setShowCopyToast] = useState(false);

            // 價格表數據
            const services = [
                { id: 'single', name: '單色', price: 600, desc: '含前置、建構、保養' },
                { id: 'cateye', name: '貓眼', price: 700, desc: '含前置、建構、保養' },
                { id: 'design_basic', name: '鏡面 / 漸層 / 法式', price: 900, desc: '含前置、建構、保養' },
                { id: 'design_simple', name: '簡約款', price: 900, desc: '簡單線條、飾品點綴' },
                { id: 'design_adv', name: '進階款', price: 1000, desc: '暈染、鏡面粉、少許凹凸' },
                { id: 'design_complex', name: '複雜款', price: 1200, desc: '手繪、大飾品、複合式凹凸' },
            ];

            const removalOptions = [
                { id: 'none', name: '無需卸甲', price: 0, type: 'none' },
                { id: 'remove_shop_new', name: '本店卸甲續作', price: 100, type: 'renew' },
                { id: 'remove_other_new', name: '他店卸甲續作', price: 200, type: 'renew' },
                { id: 'remove_shop_only', name: '本店純卸甲', price: 300, desc: '不含前置', type: 'only' },
                { id: 'remove_other_only', name: '他店純卸甲', price: 400, desc: '不含前置', type: 'only' },
                { id: 'remove_shop_care', name: '本店卸甲 + 前置保養', price: 500, type: 'care' },
            ];

            // 計算總金額
            useEffect(() => {
                let currentTotal = 0;
                if (selectedService) currentTotal += selectedService.price;
                if (selectedRemoval) currentTotal += selectedRemoval.price;
                currentTotal += repairCount * 50;
                if (isCatEyeUpgrade) currentTotal += 100;
                setTotal(currentTotal);
            }, [selectedService, selectedRemoval, repairCount, isCatEyeUpgrade]);

            // 處理服務選擇
            const handleServiceSelect = (service) => {
                setSelectedService(service);
                if (selectedRemoval && selectedRemoval.type === 'only') {
                setSelectedRemoval(removalOptions[0]);
                }
            };

            // 處理卸甲選擇
            const handleRemovalSelect = (removal) => {
                setSelectedRemoval(removal);
                if (removal.type === 'only' || removal.type === 'care') {
                setSelectedService(null);
                setIsCatEyeUpgrade(false);
                }
            };

            // 重置
            const handleReset = () => {
                setSelectedService(null);
                setSelectedRemoval(null);
                setRepairCount(0);
                setIsCatEyeUpgrade(false);
            };

            // 複製功能
            const handleCopy = () => {
                const lines = [];
                lines.push(`【美甲服務報價單】`);
                lines.push(`------------------`);
                
                let hasItem = false;

                if (selectedRemoval && selectedRemoval.id !== 'none') {
                lines.push(`■ ${selectedRemoval.name}: $${selectedRemoval.price}`);
                hasItem = true;
                }
                
                if (selectedService) {
                lines.push(`■ ${selectedService.name}: $${selectedService.price}`);
                hasItem = true;
                }

                if (isCatEyeUpgrade) {
                lines.push(`■ 加購-單色換貓眼: $100`);
                hasItem = true;
                }

                if (repairCount > 0) {
                lines.push(`■ 加購-補甲 (${repairCount}指): $${repairCount * 50}`);
                hasItem = true;
                }

                if (!hasItem) lines.push(`(未選擇項目)`);

                lines.push(`------------------`);
                lines.push(`總金額: $${total}`);

                const textToCopy = lines.join('\n');

                // 執行複製
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                document.execCommand('copy');
                setShowCopyToast(true);
                setTimeout(() => setShowCopyToast(false), 2000);
                } catch (err) {
                console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            };

            const formatCurrency = (num) => {
                return new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', minimumFractionDigits: 0 }).format(num);
            };

            return (
                <div className="min-h-screen bg-[#FDFBF7] font-sans text-slate-700 pb-24 md:pb-10 relative">
                
                {/* Toast Notification */}
                <div className={`fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-slate-800/90 text-white px-6 py-3 rounded-full shadow-xl transition-all duration-300 z-50 flex items-center gap-2 ${showCopyToast ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none'}`}>
                    <ClipboardCheck size={20} className="text-teal-400" />
                    <span>已複製報價明細！</span>
                </div>

                <div className="max-w-md mx-auto bg-white min-h-screen md:min-h-0 md:my-8 md:rounded-[2rem] md:shadow-2xl overflow-hidden flex flex-col border-4 border-white ring-1 ring-slate-100">
                    
                    {/* Header - 日系撞色設計 */}
                    <div className="bg-[#60A5FA] p-6 text-white text-center shadow-sm relative overflow-hidden">
                    {/* 裝飾性圓點 */}
                    <div className="absolute top-[-20%] left-[-10%] w-32 h-32 rounded-full bg-[#FCD34D] opacity-90"></div>
                    <div className="absolute bottom-[-10%] right-[-5%] w-24 h-24 rounded-full bg-[#F87171] opacity-80"></div>
                    
                    <h1 className="text-2xl font-bold tracking-wide relative z-10 flex items-center justify-center gap-2 drop-shadow-sm">
                        <Sparkles size={22} className="text-yellow-200" />
                        Nail Calculator
                    </h1>
                    <p className="text-blue-50 text-sm mt-1 relative z-10 font-medium tracking-wider">美甲價目計算機</p>
                    </div>

                    <div className="flex-1 overflow-y-auto p-5 space-y-8 bg-[#fffcf5]">
                    
                    {/* Section 1: 卸甲 - 暖橘色系 */}
                    <section>
                        <h2 className="text-sm font-bold text-orange-400 uppercase tracking-widest mb-3 flex items-center gap-2 pl-1">
                        <span className="w-1.5 h-4 bg-orange-400 rounded-full"></span>
                        卸甲服務 Removal
                        </h2>
                        <div className="grid grid-cols-1 gap-2.5">
                        {removalOptions.map((option) => (
                            <button
                            key={option.id}
                            onClick={() => handleRemovalSelect(option)}
                            className={`flex items-center justify-between p-3.5 rounded-2xl border-2 transition-all duration-200 group ${
                                selectedRemoval?.id === option.id
                                ? 'bg-orange-50 border-orange-400 shadow-sm'
                                : 'bg-white border-slate-100 hover:border-orange-200'
                            }`}
                            >
                            <div className="text-left">
                                <div className={`font-bold text-sm ${selectedRemoval?.id === option.id ? 'text-orange-600' : 'text-slate-600'}`}>
                                {option.name}
                                </div>
                                {option.desc && <div className="text-xs text-slate-400 mt-0.5">{option.desc}</div>}
                            </div>
                            <div className={`font-bold text-sm px-2 py-1 rounded-lg ${
                                selectedRemoval?.id === option.id ? 'bg-orange-100 text-orange-600' : 'bg-slate-50 text-slate-500'
                            }`}>
                                {option.price === 0 ? 'Free' : `$${option.price}`}
                            </div>
                            </button>
                        ))}
                        </div>
                    </section>

                    {/* Section 2: 服務 - 薄荷綠色系 */}
                    <section className={`transition-opacity duration-300 ${selectedRemoval?.type === 'only' || selectedRemoval?.type === 'care' ? 'opacity-40 pointer-events-none grayscale' : 'opacity-100'}`}>
                        <h2 className="text-sm font-bold text-teal-500 uppercase tracking-widest mb-3 flex items-center gap-2 pl-1">
                        <span className="w-1.5 h-4 bg-teal-500 rounded-full"></span>
                        美甲款式 Art Design
                        </h2>
                        <div className="grid grid-cols-1 gap-2.5">
                        {services.map((service) => (
                            <button
                            key={service.id}
                            onClick={() => handleServiceSelect(service)}
                            className={`flex items-center justify-between p-3.5 rounded-2xl border-2 transition-all duration-200 ${
                                selectedService?.id === service.id
                                ? 'bg-teal-50 border-teal-400 shadow-sm'
                                : 'bg-white border-slate-100 hover:border-teal-200'
                            }`}
                            >
                            <div className="text-left">
                                <div className={`font-bold text-sm ${selectedService?.id === service.id ? 'text-teal-700' : 'text-slate-600'}`}>
                                {service.name}
                                </div>
                                <div className="text-xs text-slate-400 mt-0.5">{service.desc}</div>
                            </div>
                            <div className={`font-bold text-sm px-2 py-1 rounded-lg ${
                                selectedService?.id === service.id ? 'bg-teal-100 text-teal-700' : 'bg-slate-50 text-slate-500'
                            }`}>
                                ${service.price}
                            </div>
                            </button>
                        ))}
                        </div>
                    </section>

                    {/* Section 3: 加購 - 柔粉色系 */}
                    <section>
                        <h2 className="text-sm font-bold text-rose-400 uppercase tracking-widest mb-3 flex items-center gap-2 pl-1">
                        <span className="w-1.5 h-4 bg-rose-400 rounded-full"></span>
                        加購 Add-ons
                        </h2>
                        <div className="bg-white rounded-3xl border-2 border-slate-100 p-5 space-y-5 shadow-sm">
                        
                        {/* 補甲 Counter */}
                        <div className="flex items-center justify-between">
                            <div>
                            <div className="font-bold text-slate-700 text-sm">補甲 Repair</div>
                            <div className="text-xs text-rose-400 font-medium mt-0.5">$50 / 指</div>
                            </div>
                            <div className="flex items-center gap-3 bg-rose-50 rounded-xl p-1.5 border border-rose-100">
                            <button 
                                onClick={() => setRepairCount(Math.max(0, repairCount - 1))}
                                className="w-8 h-8 flex items-center justify-center bg-white rounded-lg shadow-sm text-rose-500 hover:scale-105 active:scale-95 transition-all"
                            >
                                <Minus size={16} strokeWidth={3} />
                            </button>
                            <span className="w-6 text-center font-bold text-slate-700 text-lg leading-none pt-0.5">{repairCount}</span>
                            <button 
                                onClick={() => setRepairCount(repairCount + 1)}
                                className="w-8 h-8 flex items-center justify-center bg-white rounded-lg shadow-sm text-rose-500 hover:scale-105 active:scale-95 transition-all"
                            >
                                <Plus size={16} strokeWidth={3} />
                            </button>
                            </div>
                        </div>

                        <div className="border-t border-dashed border-slate-200"></div>

                        {/* 單色換貓眼 Checkbox */}
                        <button 
                            onClick={() => setIsCatEyeUpgrade(!isCatEyeUpgrade)}
                            disabled={!selectedService}
                            className={`w-full flex items-center justify-between group ${!selectedService ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                            <div className="text-left">
                            <div className="font-bold text-slate-700 text-sm">單色換貓眼</div>
                            <div className="text-xs text-slate-400 mt-0.5">需搭配基本服務 (+$100)</div>
                            </div>
                            <div className={`w-7 h-7 rounded-lg border-2 flex items-center justify-center transition-all duration-200 ${
                            isCatEyeUpgrade ? 'bg-rose-400 border-rose-400 rotate-0' : 'bg-white border-slate-200 group-hover:border-rose-300'
                            }`}>
                            {isCatEyeUpgrade && <Check size={18} className="text-white" strokeWidth={3} />}
                            </div>
                        </button>

                        </div>
                    </section>
                    </div>

                    {/* Footer / Total Bill */}
                    <div className="bg-white border-t border-slate-100 p-5 shadow-[0_-8px_30px_rgba(0,0,0,0.04)] z-20 rounded-t-3xl">
                    
                    {/* 操作區 */}
                    <div className="flex gap-3 mb-4">
                        <div className="flex-1 flex flex-col justify-center pl-2">
                            <span className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Total Amount</span>
                            <div className="text-3xl font-black text-slate-800 tracking-tight leading-none mt-1">
                            {formatCurrency(total)}
                            </div>
                        </div>
                        
                        {/* 複製按鈕 */}
                        <button 
                        onClick={handleCopy}
                        className="flex flex-col items-center justify-center px-4 py-2 bg-blue-50 text-blue-600 rounded-2xl hover:bg-blue-100 transition-colors active:scale-95 duration-200"
                        title="複製報價"
                        >
                        <Copy size={20} />
                        <span className="text-[10px] font-bold mt-1">複製</span>
                        </button>

                        {/* 重置按鈕 */}
                        <button 
                        onClick={handleReset}
                        className="flex flex-col items-center justify-center px-4 py-2 bg-slate-50 text-slate-500 rounded-2xl hover:bg-slate-100 transition-colors active:scale-95 duration-200"
                        title="重置"
                        >
                        <RotateCcw size={20} />
                        <span className="text-[10px] font-bold mt-1">重置</span>
                        </button>
                    </div>

                    {/* 簡易明細提示 (Selected Items) */}
                    <div className="flex flex-wrap gap-2 text-xs">
                        {(!selectedService && !selectedRemoval && repairCount === 0) ? (
                        <span className="px-3 py-1 bg-slate-100 text-slate-400 rounded-full">尚未選擇項目</span>
                        ) : (
                        <>
                            {selectedRemoval && selectedRemoval.id !== 'none' && (
                            <span className="px-3 py-1 bg-orange-100 text-orange-700 font-medium rounded-full border border-orange-200">
                                {selectedRemoval.name}
                            </span>
                            )}
                            {selectedService && (
                            <span className="px-3 py-1 bg-teal-100 text-teal-700 font-medium rounded-full border border-teal-200">
                            </span>
                            )}
                            {repairCount > 0 && (
                            <span className="px-3 py-1 bg-rose-100 text-rose-700 font-medium rounded-full border border-rose-200">
                                補甲x{repairCount}
                            </span>
                            )}
                            {isCatEyeUpgrade && (
                            <span className="px-3 py-1 bg-purple-100 text-purple-700 font-medium rounded-full border border-purple-200">
                                換貓眼
                            </span>
                            )}
                        </>
                        )}
                    </div>

                    </div>

                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
